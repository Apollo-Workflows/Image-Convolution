---
name: "IMGREC"
workflowBody:
- function:
    name: "ir-split"
    type: "String"
- parallelFor:
    name: "ParallelFor"
    loopCounter: {}
    loopBody:
    - function:
        name: "preprocess-imgs"
        type: "String"
        dataIns:
        - name: "s3bucket"
          type: "string"
          source: "ParallelFor/s3bucket"
        - name: "images_s3_keys"
          type: "collection"
          source: "ParallelFor/images_s3_keys"
        dataOuts:
        - name: "cropped_images_s3_keys"
          type: "collection"
    - function:
        name: "ir-delta"
        type: "String"
        dataIns:
        - name: "cropped_images_s3_keys"
          type: "collection"
          source: "preprocess-imgs/cropped_images_s3_keys"
        - name: "cropped_images_timestamps"
          type: "collection"
          source: "ParallelFor/cropped_images_timestamps"
        - name: "s3bucket"
          type: "string"
          source: "ParallelFor/s3bucket"
        dataOuts:
        - name: "all_passed"
          type: "bool"
        - name: "invalid_units_frame_keys"
          type: "collection"
        - name: "invalid_units_timestamps"
          type: "collection"
        - name: "ingested_frame_keys"
          type: "collection"
        - name: "ingested_window_start_date_millis"
          type: "number"
        - name: "ingested_window_end_date_millis"
          type: "number"
    - if:
        name: "IfThenElse"
        condition: {}
        then:
        - function:
            name: "log-valid"
            type: "String"
        else:
        - function:
            name: "ir-convolute-reduce"
            type: "String"
            dataIns:
            - name: "invalid_units_frame_keys"
              type: "collection"
              source: "ir-delta/invalid_units_frame_keys"
            - name: "invalid_units_timestamps"
              type: "collection"
              source: "ir-delta/invalid_units_timestamps"
            dataOuts:
            - name: "invalid_units_frame_keys"
              type: "collection"
            - name: "invalid_units_timestamps"
              type: "collection"
            - name: "invalid_units_deviations"
              type: "collection"
        - function:
            name: "log-invalid"
            type: "String"
- function:
    name: "ir-reduce"
    type: "String"
- if:
    name: "IfThenElse1"
    condition: {}
    then:
    - function:
        name: "log-valid-batch"
        type: "String"
    else:
    - function:
        name: "log-invalid-batch"
        type: "String"
